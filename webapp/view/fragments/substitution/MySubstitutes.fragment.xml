<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
>
    <IconTabFilter
        id="tabOutgoing"
        text="{i18n>substTabOutgoing}"
        icon="sap-icon://outgoing-call"
        key="outgoing"
    >
        <VBox class="sapUiSmallMargin">
            <!-- Mode Switcher with Add Button -->
            <Toolbar
                class="sapUiTransparent"
                style="Clear"
            >
                <SegmentedButton
                    id="modeSelector"
                    selectedKey="{view>/substMode}"
                    selectionChange=".onModeSelect"
                >
                    <items>
                        <SegmentedButtonItem
                            key="P"
                            text="{i18n>substModePlanned}"
                            icon="sap-icon://calendar"
                        />
                        <SegmentedButtonItem
                            key="U"
                            text="{i18n>substModeUnplanned}"
                            icon="sap-icon://alert"
                        />
                    </items>
                </SegmentedButton>
                <ToolbarSpacer />
                <Button
                    text="{i18n>substAdd}"
                    icon="sap-icon://add"
                    type="Emphasized"
                    press=".onOpenAddDialog"
                />
            </Toolbar>

            <!-- Table for Planned Substitutions -->
            <Table
                id="tablePlanned"
                items="{
                    path: '/Substitutions',
                    parameters: {
                        $select: 'UserSubstitutedBy,UserSubstitutedFor,BeginDate,EndDate,SubstitutionProfile,RuleStatus,SubstituteFullName,OwnerFullName,SubstitutionType,Direction,Active,DaysToStart'
                    }
                }"
                visible="{= ${view>/substMode} === 'P'}"
                sticky="ColumnHeaders"
                growing="true"
                growingThreshold="20"
                noDataText="{i18n>substNoData}"
            >
                <columns>
                    <Column width="12em">
                        <Text text="{i18n>colSubstituteName}" />
                    </Column>
                    <Column width="12em">
                        <Text text="{i18n>colTaskGroup}" />
                    </Column>
                    <Column width="10em">
                        <Text text="{i18n>colStartDate}" />
                    </Column>
                    <Column width="10em">
                        <Text text="{i18n>colEndDate}" />
                    </Column>
                    <Column
                        width="8em"
                        hAlign="Center"
                    >
                        <Text text="{i18n>colStatus}" />
                    </Column>
                    <Column
                        width="6em"
                        hAlign="End"
                    >
                        <Text text="" />
                    </Column>
                </columns>
                <items>
                    <ColumnListItem>
                        <cells>
                            <VBox>
                                <Link
                                    text="{SubstituteFullName}"
                                    press=".onShowUserInfo"
                                    class="sapUiTinyMarginEnd sapUiTextBold"
                                />
                                <Text
                                    text="{
                                        parts: [
                                            {path: 'RuleStatus', targetType: 'any'},
                                            {path: 'DaysToStart', targetType: 'any'}
                                        ],
                                        formatter: '.formatter.formatDaysToStartText'
                                    }"
                                    visible="{= %{RuleStatus} === 'Inactive' }"
                                    class="substDimmedText sapUiTinyMarginTop"
                                />
                            </VBox>
                            <Text text="{SubstitutionProfile}" />
                            <Text
                                text="{
                                    path: 'BeginDate',
                                    type: 'sap.ui.model.type.Date',
                                    formatOptions: {
                                        source: { pattern: 'yyyy-MM-dd' },
                                        pattern: 'dd/MM/yyyy'
                                    }
                                }"
                            />
                            <Text
                                text="{
                                    path: 'EndDate',
                                    type: 'sap.ui.model.type.Date',
                                    formatOptions: {
                                        source: { pattern: 'yyyy-MM-dd' },
                                        pattern: 'dd/MM/yyyy'
                                    }
                                }"
                            />
                            <ObjectStatus
                                state="{
                                    path: 'RuleStatus',
                                    formatter: '.formatter.formatStatusState'
                                }"
                                icon="{
                                    path: 'RuleStatus',
                                    formatter: '.formatter.formatStatusIcon'
                                }"
                            />
                            <HBox justifyContent="End">
                                <Button
                                    icon="sap-icon://edit"
                                    type="Transparent"
                                    tooltip="{i18n>btnEdit}"
                                    press=".onOpenUpdateDialog"
                                    class="sapUiTinyMarginEnd"
                                />
                                <Button
                                    icon="sap-icon://delete"
                                    type="Transparent"
                                    tooltip="{i18n>btnDelete}"
                                    press=".onDeleteRule"
                                />
                            </HBox>
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>

            <!-- Table for Unplanned Substitutions -->
            <Table
                id="tableUnplanned"
                items="{
                    path: '/Substitutions',
                    parameters: {
                        $select: 'UserSubstitutedBy,UserSubstitutedFor,BeginDate,EndDate,SubstitutionProfile,RuleStatus,SubstituteFullName,OwnerFullName,SubstitutionType,Direction,Active'
                    },
                    sorter: {
                        path: 'SubstituteFullName',
                        descending: false,
                        group: true
                    },
                    groupHeaderFactory: '.createGroupHeader'
                }"
                visible="{= ${view>/substMode} === 'U'}"
                sticky="ColumnHeaders"
                growing="true"
                growingThreshold="20"
                noDataText="{i18n>substNoData}"
                class="sapUiSmallMarginTop"
            >
                <columns>
                    <Column width="12em">
                        <Text text="{i18n>colTaskGroup}" />
                    </Column>
                    <Column width="10em">
                        <Text text="{i18n>colStartDate}" />
                    </Column>
                    <Column
                        width="8em"
                        hAlign="Center"
                    >
                        <Text text="{i18n>colStatus}" />
                    </Column>
                    <Column
                        width="6em"
                        hAlign="End"
                    >
                        <Text text="" />
                    </Column>
                </columns>
                <items>
                    <ColumnListItem vAlign="Middle">
                        <cells>
                            <Text text="{SubstitutionProfile}" />
                            <Text
                                text="{
                                    parts: ['SubstitutionType', 'BeginDate'],
                                    formatter: '.formatter.formatDateOrNA'
                                }"
                            />
                            <ObjectStatus
                                state="{= %{Active} === true ? 'Success' : 'Error' }"
                                icon="{= %{Active} === true ? 'sap-icon://status-positive' : 'sap-icon://status-inactive' }"
                            />
                            <HBox
                                justifyContent="End"
                                alignItems="Center"
                            >
                                <Button
                                    icon="sap-icon://delete"
                                    type="Transparent"
                                    tooltip="{i18n>btnDelete}"
                                    press=".onDeleteRule"
                                    visible="{= %{Direction} === 'OUTGOING' }"
                                />
                            </HBox>
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>
        </VBox>
    </IconTabFilter>
</core:FragmentDefinition>
