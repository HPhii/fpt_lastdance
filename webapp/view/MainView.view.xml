<mvc:View
    xmlns:simple="sap.gantt.simple"
    controllerName="z.wf.zwfmanagement.controller.MainView"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:l="sap.ui.layout"
    xmlns:f="sap.f"
    height="100%"
>
    <f:DynamicPage
        id="dynamicPage"
        headerExpanded="true"
        showFooter="{= !${worklistView>/detailVisible} }"
        toggleHeaderOnTitleClick="false"
    >
        <f:title>
            <f:DynamicPageTitle>
                <f:navigationActions>
                    <Button
                        type="Back"
                        press=".onNavBackToDashboard"
                    />
                </f:navigationActions>
                <f:heading>
                    <Title text="{i18n>title}" />
                </f:heading>
                <f:actions>
                    <core:Fragment
                        fragmentName="z.wf.zwfmanagement.view.fragments.LanguageSelect"
                        type="XML"
                    />
                </f:actions>
            </f:DynamicPageTitle>
        </f:title>
        <f:content>
            <IconTabBar
                id="iconTabBar"
                select=".onFilterStatus"
                expandable="false"
                stretchContentHeight="true"
                upperCase="true"
            >
                <items>
                    <IconTabFilter
                        key="all"
                        showAll="true"
                        count="{/WfTasks/$count}"
                        text="{i18n>WorklistFilterTasksAll}"
                    />
                    <IconTabSeparator />
                    <IconTabFilter
                        key="ready"
                        icon="sap-icon://task"
                        iconColor="Default"
                        text="{i18n>WorklistFilterTasksReady}"
                        count="{
                            path: '/WfTasks/$count',
                            parameters: {
                                $filter: 'TechnicalStatus eq \'READY\''
                            }
                        }"
                    />
                    <IconTabFilter
                        key="selected"
                        icon="sap-icon://employee-approvals"
                        iconColor="Neutral"
                        text="{i18n>WorklistFilterTasksSelected}"
                        count="{
                            path: '/WfTasks/$count',
                            parameters: {
                                $filter: 'TechnicalStatus eq \'SELECTED\''
                            }
                        }"
                    />
                    <IconTabFilter
                        key="started"
                        icon="sap-icon://begin"
                        iconColor="Critical"
                        text="{i18n>WorklistFilterTasksStarted}"
                        count="{
                            path: '/WfTasks/$count',
                            parameters: {
                                $filter: 'TechnicalStatus eq \'STARTED\''
                            }
                        }"
                    />
                    <IconTabFilter
                        key="committed"
                        icon="sap-icon://org-chart"
                        iconColor="Critical"
                        text="{i18n>WorklistFilterTasksCommitted}"
                        count="{
                            path: '/WfTasks/$count',
                            parameters: {
                                $filter: 'TechnicalStatus eq \'COMMITTED\''
                            }
                        }"
                    />
                    <IconTabFilter
                        key="waiting"
                        icon="sap-icon://pending"
                        iconColor="Critical"
                        text="{i18n>WorklistFilterTasksWaiting}"
                        count="{
                            path: '/WfTasks/$count',
                            parameters: {
                                $filter: 'TechnicalStatus eq \'WAITING\''
                            }
                        }"
                    />
                    <IconTabFilter
                        key="checked"
                        icon="sap-icon://inspection"
                        iconColor="Positive"
                        text="{i18n>WorklistFilterTasksChecked}"
                        count="{
                            path: '/WfTasks/$count',
                            parameters: {
                                $filter: 'TechnicalStatus eq \'CHECKED\''
                            }
                        }"
                    />
                    <IconTabFilter
                        key="completed"
                        icon="sap-icon://complete"
                        iconColor="Positive"
                        text="{i18n>WorklistFilterTasksCompleted}"
                        count="{
                            path: '/WfTasks/$count',
                            parameters: {
                                $filter: 'TechnicalStatus eq \'COMPLETED\''
                            }
                        }"
                    />
                    <IconTabFilter
                        key="cancelled"
                        icon="sap-icon://decline"
                        iconColor="Negative"
                        text="{i18n>WorklistFilterTasksCancelled}"
                        count="{
                            path: '/WfTasks/$count',
                            parameters: {
                                $filter: 'TechnicalStatus eq \'CANCELLED\''
                            }
                        }"
                    />
                    <IconTabFilter
                        key="overdue"
                        icon="sap-icon://error"
                        iconColor="Negative"
                        text="{i18n>WorklistFilterTasksError}"
                        count="{
                            path: '/WfTasks/$count',
                            parameters: {
                                $filter: 'TechnicalStatus eq \'ERROR\''
                            }
                        }"
                    />
                </items>
                <content>
                    <ScrollContainer
                        height="100%"
                        width="100%"
                        vertical="true"
                        horizontal="false"
                    >
                        <Table
                            id="idTasksList"
                            sticky="ColumnHeaders,HeaderToolbar"
                            inset="false"
                            growing="true"
                            items="{ 
                                path: '/WfTasks',
                                sorter: { path: 'Priority', descending: false }
                            }"
                            growingThreshold="20"
                            selectionChange=".onSelectionChange"
                            class="sapFDynamicPageAlignContent"
                            width="auto"
                            mode="{worklistView>/listMode}"
                        >
                            <headerToolbar>
                                <OverflowToolbar>
                                    <Toolbar>
                                        <Title
                                            text="{i18n>tableHeaderTitle} {worklistView>/worklistTableTitle}"
                                            level="H2"
                                        />
                                        <ToolbarSpacer />
                                        <Button
                                            icon="sap-icon://sort"
                                            press=".onSort"
                                            tooltip="{i18n>tooltipHeaderSort}"
                                        />
                                        <Button
                                            icon="sap-icon://filter"
                                            press=".onFilter"
                                            tooltip="{i18n>tooltipHeaderFilter}"
                                        />
                                        <Button
                                            icon="sap-icon://group-2"
                                            press=".onGroup"
                                            tooltip="{i18n>tooltipHeaderGroup}"
                                        />
                                        <Button
                                            icon="sap-icon://action-settings"
                                            press=".onCustomColumn"
                                            tooltip="Settings"
                                        />
                                        <Button
                                            text="{i18n>tableHeaderSelectAll}"
                                            press=".onSelectAll"
                                            icon="sap-icon://multiselect-all"
                                            visible="{= ${worklistView>/listMode} === 'MultiSelect' }"
                                        />
                                        <Button
                                            text="{i18n>tableHeaderDeselectAll}"
                                            press=".onDeselectAll"
                                            icon="sap-icon://multiselect-none"
                                            visible="{= ${worklistView>/listMode} === 'MultiSelect' }"
                                        />
                                        <Button
                                            icon="sap-icon://multi-select"
                                            press=".onToggleMultiSelect"
                                            tooltip="Toggle Multi-Select Mode"
                                            type="{= ${worklistView>/listMode} === 'MultiSelect' ? 'Emphasized' : 'Default' }"
                                        />
                                        <SearchField
                                            width="auto"
                                            placeholder="{i18n>tableHeaderSearchPlaceholder}"
                                            search=".onSearch"
                                        />
                                    </Toolbar>
                                </OverflowToolbar>
                            </headerToolbar>
                            <columns>
                                <Column
                                    id="colTaskName"
                                    visible="{worklistView>/columns/taskName}"
                                >
                                    <Text text="{i18n>columnTaskName}" />
                                </Column>
                                <Column
                                    id="colTaskID"
                                    minScreenWidth="Tablet"
                                    demandPopin="true"
                                    visible="{worklistView>/columns/taskID}"
                                >
                                    <Text text="{i18n>columnTaskId}" />
                                </Column>
                                <Column
                                    id="colWorkItemID"
                                    minScreenWidth="Tablet"
                                    demandPopin="true"
                                    visible="{worklistView>/columns/workItemID}"
                                >
                                    <Text text="{i18n>columnTaskWorkItemId}" />
                                </Column>
                                <Column
                                    id="colCreationDate"
                                    minScreenWidth="Tablet"
                                    demandPopin="true"
                                    visible="{worklistView>/columns/creationDate}"
                                >
                                    <Text
                                        text="{i18n>columnTaskCreationDate}"
                                    />
                                </Column>
                                <Column
                                    id="colEndDate"
                                    minScreenWidth="Tablet"
                                    demandPopin="true"
                                    visible="{worklistView>/columns/endDate}"
                                >
                                    <Text text="{i18n>columnTaskEndDate}" />
                                </Column>
                                <Column
                                    id="colDaysToDeadline"
                                    minScreenWidth="Desktop"
                                    visible="{worklistView>/columns/daysToDeadline}"
                                >
                                    <Text
                                        text="{i18n>columnTaskDaysToDeadline}"
                                    />
                                </Column>
                                <Column
                                    id="colStatus"
                                    minScreenWidth="Desktop"
                                    demandPopin="true"
                                    hAlign="Center"
                                    visible="{worklistView>/columns/status}"
                                >
                                    <Text text="{i18n>columnTaskStatus}" />
                                </Column>

                                <Column
                                    id="colAssignedUser"
                                    minScreenWidth="Desktop"
                                    demandPopin="true"
                                    visible="{worklistView>/columns/assignedUser}"
                                >
                                    <Text
                                        text="{i18n>columnTaskAssignedUser}"
                                    />
                                </Column>
                                <Column
                                    id="colAssignedUserName"
                                    minScreenWidth="Desktop"
                                    demandPopin="true"
                                    visible="{worklistView>/columns/assignedUserName}"
                                >
                                    <Text
                                        text="{i18n>columnTaskAssignedUserName}"
                                    />
                                </Column>
                                <Column
                                    id="colPriority"
                                    hAlign="Center"
                                    visible="{worklistView>/columns/priority}"
                                >
                                    <Text text="{i18n>columnTaskPriority}" />
                                </Column>
                            </columns>
                            <items>
                                <ColumnListItem
                                    type="Navigation"
                                    press=".onTaskPress"
                                    vAlign="Middle"
                                >
                                    <cells>
                                        <ObjectIdentifier
                                            title="{WorkItemText}"
                                            text="{TaskText}"
                                        />
                                        <Text text="{TaskID}" />
                                        <Text text="{WorkItemID}" />
                                        <ObjectIdentifier
                                            text="{CreationDate}"
                                        />
                                        <Text text="{= ${EndDate} || 'N/A' }" />
                                        <ObjectAttribute
                                            text="{= 
                                                ${DaysToDeadline} &gt; '1000' 
                                                ? 'Infinity' 
                                                : ${DaysToDeadline} &lt; '1' 
                                                ? 'Overdue' : ${DaysToDeadline} + 'Days'
                                            }"
                                        />
                                        <ObjectStatus
                                            class="sapUiTextBold"
                                            text="{TechnicalStatus}"
                                            state="{
                                                path: 'TechnicalStatus',
                                                formatter: '.formatter.technicalStatusState'
                                            }"
                                        />
                                        <Text text="{AssignedUser}" />
                                        <Text text="{AssignedUserName}" />
                                        <ObjectStatus
                                            text="{PriorityText}"
                                            icon="sap-icon://{= ${Priority} &lt; '5' ? 'alert' : 'information' }"
                                            state="{= ${Priority} &lt; '5' ? 'Warning' : 'Information' }"
                                        />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </ScrollContainer>
                </content>
            </IconTabBar>
        </f:content>
        <f:footer>
            <OverflowToolbar id="otbFooter">
                <ToolbarSpacer />
                <Button
                    type="Default"
                    text="{i18n>buttonFooterDelegate}"
                >
                    <layoutData>
                        <OverflowToolbarLayoutData priority="NeverOverflow" />
                    </layoutData>
                </Button>
                <Button
                    type="Emphasized"
                    text="{i18n>buttonFooterSubtitute}"
                >
                    <layoutData>
                        <OverflowToolbarLayoutData priority="NeverOverflow" />
                    </layoutData>
                </Button>
                <OverflowToolbarButton
                    tooltip="Share"
                    text="Share"
                    icon="sap-icon://action"
                />
            </OverflowToolbar>
        </f:footer>
    </f:DynamicPage>
</mvc:View>
